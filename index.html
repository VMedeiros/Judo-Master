<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <meta
      name="description"
      content="Sistema de gerenciamento de técnicas de Judô por graduação de faixas"
    />
    <meta name="theme-color" content="#c8102e" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Judô Master" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/icons/icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/icons/icon-192x192.png"
    />
    <title>Judô Master - Gerenciamento de Técnicas</title>
    <!-- Preconnect para otimização de fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Tailwind via build (PostCSS). Evitar CDN em produção. -->
    <style>
      /* Custom scrollbar for a better look */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .dark ::-webkit-scrollbar-track {
        background: #2d3748;
      }
      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #555;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background: #333;
      }

      /* Splash Screen / Loading */
      #app-splash {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #c8102e 0%, #a10d24 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out;
      }

      #app-splash.loaded {
        opacity: 0;
        pointer-events: none;
      }

      .splash-logo {
        width: 120px;
        height: 120px;
        margin-bottom: 2rem;
        animation: pulse 2s ease-in-out infinite;
      }

      .splash-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        margin-bottom: 0.5rem;
        font-family: "Noto Serif JP", serif;
      }

      .splash-subtitle {
        font-size: 1.25rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2rem;
      }

      .splash-loader {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .splash-loading-text {
        margin-top: 1rem;
        color: white;
        font-size: 0.875rem;
        opacity: 0.8;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
      }

      /* Skeleton loader styles */
      .skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: loading 1.5s ease-in-out infinite;
      }

      .dark .skeleton {
        background: linear-gradient(
          90deg,
          #2d3748 25%,
          #1a202c 50%,
          #2d3748 75%
        );
        background-size: 200% 100%;
      }

      @keyframes loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "rxjs": "https://aistudiocdn.com/rxjs@^7.8.2?conditions=es2015",
          "rxjs/operators": "https://aistudiocdn.com/rxjs@^7.8.2/operators?conditions=es2015",
          "rxjs/ajax": "https://aistudiocdn.com/rxjs@^7.8.2/ajax?conditions=es2015",
          "rxjs/webSocket": "https://aistudiocdn.com/rxjs@^7.8.2/webSocket?conditions=es2015",
          "rxjs/testing": "https://aistudiocdn.com/rxjs@^7.8.2/testing?conditions=es2015",
          "rxjs/fetch": "https://aistudiocdn.com/rxjs@^7.8.2/fetch?conditions=es2015",
          "@angular/compiler": "https://next.esm.sh/@angular/compiler@^21.0.1?external=rxjs",
          "@angular/core": "https://next.esm.sh/@angular/core@^21.0.1?external=rxjs",
          "@angular/common": "https://next.esm.sh/@angular/common@^21.0.1?external=rxjs",
          "@angular/common/http": "https://next.esm.sh/@angular/common@^21.0.1/http?external=rxjs",
          "@angular/platform-browser": "https://next.esm.sh/@angular/platform-browser@^21.0.1?external=rxjs"
        }
      }
    </script>
    <script>
      // Registrar Service Worker para PWA
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("ngsw-worker.js")
            .then((reg) => console.log("Service Worker registrado:", reg))
            .catch((err) =>
              console.log("Erro ao registrar Service Worker:", err),
            );

          // Força reload quando o controlador do SW muda (novo deploy)
          let reloaded = false;
          navigator.serviceWorker.addEventListener("controllerchange", () => {
            if (reloaded) return;
            reloaded = true;
            // Recarrega para obter o index.html e bundles atualizados
            window.location.reload();
          });

          // Opcional: escuta mensagens do SW
          navigator.serviceWorker.addEventListener("message", (event) => {
            if (event.data?.type === "SW_ACTIVATED") {
              console.log("SW ativado:", event.data);
            }
          });
        });
      }
    </script>
  </head>
  <body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Splash Screen -->
    <div id="app-splash">
      <svg
        class="splash-logo"
        viewBox="0 0 64 64"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M42.41 13.59c-2.34-2.34-5.43-3.59-8.7-3.59s-6.36 1.25-8.7 3.59c-4.82 4.82-4.82 12.58 0 17.4L32 38l7-7-8.5-8.5"
          stroke="#FBBF24"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M21.59 50.41c2.34 2.34 5.43 3.59 8.7 3.59s6.36-1.25 8.7-3.59c4.82-4.82 4.82-12.58 0-17.4L32 26l-7 7 8.5 8.5"
          stroke="#4F46E5"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <h1 class="splash-title">Judô Master</h1>
      <p class="splash-subtitle">Gerenciamento de Técnicas</p>
      <div class="splash-loader"></div>
      <p class="splash-loading-text">Carregando...</p>
    </div>

    <app-root>
      <!-- Loading fallback content -->
      <div
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          padding: 2rem;
        "
      >
        <div style="width: 100%; max-width: 400px">
          <!-- Header skeleton -->
          <div
            class="skeleton"
            style="
              height: 60px;
              width: 100%;
              margin-bottom: 2rem;
              border-radius: 8px;
            "
          ></div>

          <!-- Card skeletons -->
          <div
            class="skeleton"
            style="
              height: 200px;
              width: 100%;
              margin-bottom: 1rem;
              border-radius: 12px;
            "
          ></div>
          <div
            class="skeleton"
            style="
              height: 200px;
              width: 100%;
              margin-bottom: 1rem;
              border-radius: 12px;
            "
          ></div>
          <div
            class="skeleton"
            style="
              height: 200px;
              width: 100%;
              margin-bottom: 1rem;
              border-radius: 12px;
            "
          ></div>
        </div>
      </div>
    </app-root>

    <script>
      // Remove splash screen quando o Angular carregar
      window.addEventListener("load", () => {
        setTimeout(() => {
          const splash = document.getElementById("app-splash");
          if (splash) {
            splash.classList.add("loaded");
            setTimeout(() => {
              splash.style.display = "none";
            }, 500);
          }
        }, 1000); // Mantém o splash por pelo menos 1 segundo
      });
    </script>
  </body>
</html>
